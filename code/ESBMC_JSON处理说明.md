# ESBMC Python Frontend - JSONå¤„ç†è¯´æ˜

## ğŸ¯ æ¦‚è¿°

æ‚¨è¯´å¾—å¯¹ï¼ESBMCçš„Python Frontendåœ¨å¤„ç†Pythonä»£ç æ—¶ç¡®å®ä¼šæ¶‰åŠ**ä¸¤ä¸ªå…³é”®çš„JSONæ–‡ä»¶**ï¼š

1. **AST JSON** - Pythonä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘JSONè¡¨ç¤º
2. **ç±»å‹æ ‡æ³¨JSON** - æ·»åŠ äº†ç±»å‹ä¿¡æ¯çš„AST JSON

---

## ğŸ“Š ESBMC Python Frontendå·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pythonæºä»£ç     â”‚
â”‚   (.pyæ–‡ä»¶)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ASTç”Ÿæˆ     â”‚  â† ä½¿ç”¨Pythonçš„astæ¨¡å—
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€JSON 1ã€‘      â”‚  â† ç¬¬ä¸€ä¸ªJSONï¼šASTçš„JSONè¡¨ç¤º
â”‚  AST JSON       â”‚     (ä½¿ç”¨ast2jsonè½¬æ¢)
â”‚  _ast.json      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç±»å‹æ ‡æ³¨    â”‚  â† åŸºäºPEP 484ç±»å‹æ³¨è§£
â”‚  Type Annotationâ”‚     è‡ªåŠ¨ç±»å‹æ¨æ–­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€JSON 2ã€‘      â”‚  â† ç¬¬äºŒä¸ªJSONï¼šå¸¦ç±»å‹ä¿¡æ¯çš„AST
â”‚ Typed AST JSON  â”‚
â”‚ _typed_ast.json â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ç¬¦å·è¡¨ç”Ÿæˆ  â”‚  â† ä½¿ç”¨C++ IRep API
â”‚  Symbol Table   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. GOTOç¨‹åº    â”‚  â† æ§åˆ¶æµå›¾
â”‚  GOTO Program   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ç¬¦å·æ‰§è¡Œ    â”‚  â† ç”ŸæˆSMTå…¬å¼
â”‚  Symbolic Exec  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. SMTæ±‚è§£å™¨   â”‚  â† Z3/Boolectorç­‰
â”‚  Verification   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éªŒè¯ç»“æœè¾“å‡º    â”‚  SUCCESS / FAILED
â”‚  + åä¾‹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ä¸¤ä¸ªJSONæ–‡ä»¶è¯¦è§£

### JSON 1: AST JSON

**ç”Ÿæˆæ–¹å¼**:
```python
import ast
import ast2json

# è¯»å–Pythonä»£ç 
with open('test.py', 'r') as f:
    source = f.read()

# è§£æä¸ºAST
tree = ast.parse(source)

# è½¬æ¢ä¸ºJSON
ast_json = ast2json.ast2json(tree)
```

**å†…å®¹ç¤ºä¾‹**:
```json
{
  "_type": "Module",
  "body": [
    {
      "_type": "FunctionDef",
      "name": "test_function",
      "args": {
        "_type": "arguments",
        "args": [
          {
            "_type": "arg",
            "arg": "x",
            "annotation": {
              "_type": "Name",
              "id": "int"
            }
          }
        ]
      },
      "body": [
        {
          "_type": "Return",
          "value": {
            "_type": "BinOp",
            "left": {
              "_type": "Name",
              "id": "x"
            },
            "op": {
              "_type": "Mult"
            },
            "right": {
              "_type": "Constant",
              "value": 2
            }
          }
        }
      ]
    }
  ]
}
```

**ä½œç”¨**: 
- ä¿ç•™Pythonä»£ç çš„å®Œæ•´ç»“æ„
- ä½œä¸ºç±»å‹æ¨æ–­çš„è¾“å…¥

---

### JSON 2: ç±»å‹æ ‡æ³¨JSON

**ç”Ÿæˆæ–¹å¼**:
ESBMCå†…éƒ¨è‡ªåŠ¨å¤„ç†ï¼ŒåŸºäºï¼š
1. æ˜¾å¼ç±»å‹æ³¨è§£ï¼ˆå¦‚ `x: int = 5`ï¼‰
2. å¸¸é‡ç±»å‹æ¨æ–­ï¼ˆå¦‚ `x = 10` â†’ intï¼‰
3. è¡¨è¾¾å¼ç±»å‹æ¨æ–­ï¼ˆå¦‚ `x + y` â†’ æ ¹æ®xå’Œyçš„ç±»å‹ï¼‰

**å†…å®¹ç¤ºä¾‹**ï¼ˆæ¦‚å¿µæ€§ï¼‰:
```json
{
  "_type": "Module",
  "body": [
    {
      "_type": "FunctionDef",
      "name": "test_function",
      "return_type": "int",  â† æ·»åŠ çš„ç±»å‹ä¿¡æ¯
      "args": [
        {
          "name": "x",
          "type": "int",  â† æ˜ç¡®çš„å‚æ•°ç±»å‹
          "annotation": "int"
        }
      ],
      "body": [
        {
          "_type": "Return",
          "value": {
            "_type": "BinOp",
            "inferred_type": "int",  â† æ¨æ–­çš„è¡¨è¾¾å¼ç±»å‹
            "left": {
              "_type": "Name",
              "id": "x",
              "type": "int"
            },
            "op": "Mult",
            "right": {
              "_type": "Constant",
              "value": 2,
              "type": "int"
            }
          }
        }
      ]
    }
  ]
}
```

**ä½œç”¨**:
- ä¸ºç¬¦å·æ‰§è¡Œæä¾›ç±»å‹ä¿¡æ¯
- æ”¯æŒç±»å‹ç›¸å…³çš„éªŒè¯ï¼ˆå¦‚ç±»å‹è½¬æ¢ã€æº¢å‡ºæ£€æŸ¥ï¼‰

---

## ğŸ› ï¸ ç”ŸæˆJSONæ–‡ä»¶çš„å·¥å…·

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªå·¥å…·è„šæœ¬ï¼š**`generate_ast_json.py`**

### ä½¿ç”¨æ–¹æ³•

#### 1. å®‰è£…ä¾èµ–
```bash
pip install ast2json
```

#### 2. ç”Ÿæˆå•ä¸ªæ–‡ä»¶çš„JSON
```bash
python generate_ast_json.py esbmc_verification_tests.py
```

**è¾“å‡º**:
- `esbmc_verification_tests_ast.json` - AST JSON
- `esbmc_verification_tests_typed_ast.json` - ç±»å‹æ ‡æ³¨JSONï¼ˆç®€åŒ–ç‰ˆï¼‰

#### 3. æ‰¹é‡ç”Ÿæˆ
```bash
# å¤„ç†æ‰€æœ‰.pyæ–‡ä»¶
python generate_ast_json.py --batch

# å¤„ç†ç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶
python generate_ast_json.py --batch "test_*.py"
```

---

## ğŸ“– ç¤ºä¾‹ï¼šå®Œæ•´æµç¨‹æ¼”ç¤º

### æ­¥éª¤1: å‡†å¤‡æµ‹è¯•ä»£ç 

**test_simple.py**:
```python
def add(x: int, y: int) -> int:
    """ç®€å•çš„åŠ æ³•å‡½æ•°"""
    result: int = x + y
    assert result >= x, "Result should be >= x"
    return result

# æµ‹è¯•
a: int = 5
b: int = 10
c: int = add(a, b)
assert c == 15
```

### æ­¥éª¤2: ç”ŸæˆAST JSON

```bash
python generate_ast_json.py test_simple.py
```

**è¾“å‡ºä¿¡æ¯**:
```
============================================================
å¤„ç†æ–‡ä»¶: test_simple.py
============================================================
âœ“ AST JSONå·²ç”Ÿæˆ: test_simple_ast.json
  - æºæ–‡ä»¶: test_simple.py
  - JSONå¤§å°: 3247 å­—èŠ‚

ğŸ“Š ASTç»“æ„åˆ†æ:
  - èŠ‚ç‚¹ç±»å‹æ€»æ•°: 15
  - èŠ‚ç‚¹æ€»æ•°: 45
  
  ä¸»è¦èŠ‚ç‚¹ç±»å‹:
    â€¢ Name: 12ä¸ª
    â€¢ arg: 3ä¸ª
    â€¢ Load: 8ä¸ª
    â€¢ FunctionDef: 1ä¸ª
    â€¢ arguments: 1ä¸ª
    ...

============================================================
âœ“ ç±»å‹æ ‡æ³¨JSONå·²ç”Ÿæˆ: test_simple_typed_ast.json
============================================================

âœ… å®Œæˆï¼
```

### æ­¥éª¤3: æŸ¥çœ‹ç”Ÿæˆçš„JSON

**test_simple_ast.json** (éƒ¨åˆ†):
```json
{
  "_type": "Module",
  "body": [
    {
      "_type": "FunctionDef",
      "name": "add",
      "lineno": 1,
      "col_offset": 0,
      "returns": {
        "_type": "Name",
        "id": "int",
        "ctx": {
          "_type": "Load"
        }
      }
    }
  ]
}
```

### æ­¥éª¤4: ä½¿ç”¨ESBMCéªŒè¯

```bash
# ESBMCä¼šè‡ªåŠ¨å¤„ç†è¿™äº›æ­¥éª¤
esbmc test_simple.py
```

ESBMCå†…éƒ¨ä¼šï¼š
1. è‡ªåŠ¨ç”ŸæˆAST JSON
2. è‡ªåŠ¨è¿›è¡Œç±»å‹æ ‡æ³¨
3. ç”Ÿæˆç¬¦å·è¡¨å’ŒGOTOç¨‹åº
4. æ‰§è¡ŒéªŒè¯

---

## ğŸ¤” å¸¸è§é—®é¢˜

### Q1: ESBMCè¿è¡Œæ—¶èƒ½çœ‹åˆ°è¿™äº›JSONæ–‡ä»¶å—ï¼Ÿ

**A**: é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½ã€‚ESBMCå°†è¿™äº›æ­¥éª¤åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†æ˜¯ï¼š

```bash
# å¯ä»¥ä½¿ç”¨debugé€‰é¡¹æŸ¥çœ‹ä¸­é—´è¿‡ç¨‹
esbmc test.py --show-goto-functions  # æ˜¾ç¤ºGOTOç¨‹åº
esbmc test.py --show-symbol-table     # æ˜¾ç¤ºç¬¦å·è¡¨
```

### Q2: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªJSONï¼Ÿ

**A**: 
- **JSON 1 (AST)**: ä¿ç•™åŸå§‹ä»£ç ç»“æ„ï¼Œç”¨äºè¯­æ³•åˆ†æ
- **JSON 2 (Typed AST)**: æ·»åŠ ç±»å‹ä¿¡æ¯ï¼Œç”¨äºç±»å‹æ£€æŸ¥å’Œç¬¦å·æ‰§è¡Œ

è¿™æ˜¯æ ‡å‡†çš„ç¼–è¯‘å™¨å‰ç«¯è®¾è®¡ï¼š**è¯­æ³•åˆ†æ â†’ è¯­ä¹‰åˆ†æ**

### Q3: ç”Ÿæˆçš„JSONæ–‡ä»¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

**A**: 
1. **è°ƒè¯•**: ç†è§£ESBMCå¦‚ä½•è§£æä½ çš„ä»£ç 
2. **å­¦ä¹ **: äº†è§£ASTå’Œç±»å‹ç³»ç»Ÿ
3. **å·¥å…·å¼€å‘**: å¼€å‘åŸºäºASTçš„åˆ†æå·¥å…·
4. **æ•™å­¦**: å±•ç¤ºç¼–è¯‘å™¨å‰ç«¯å·¥ä½œåŸç†

### Q4: ç±»å‹æ ‡æ³¨JSONçš„å®é™…å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ

**A**: 
å®é™…çš„ç±»å‹æ ‡æ³¨ç”±ESBMCå†…éƒ¨C++ä»£ç å®Œæˆï¼Œä¸ä¼šç›´æ¥è¾“å‡ºJSONæ–‡ä»¶ã€‚æˆ‘ä»¬çš„å·¥å…·ç”Ÿæˆçš„æ˜¯**ç®€åŒ–ç¤ºä¾‹**ï¼Œå±•ç¤ºæ¦‚å¿µã€‚

çœŸå®çš„ç±»å‹æ ‡æ³¨åŒ…æ‹¬ï¼š
- å˜é‡ç±»å‹æ¨æ–­
- è¡¨è¾¾å¼ç±»å‹è®¡ç®—
- ç±»å‹å…¼å®¹æ€§æ£€æŸ¥
- ç±»å‹è½¬æ¢å¤„ç†

---

## ğŸ“ æ·±å…¥ç†è§£ï¼šASTèŠ‚ç‚¹ç±»å‹

### å¸¸è§ASTèŠ‚ç‚¹

| èŠ‚ç‚¹ç±»å‹ | å«ä¹‰ | ç¤ºä¾‹ |
|---------|------|------|
| `Module` | æ¨¡å—æ ¹èŠ‚ç‚¹ | æ•´ä¸ªæ–‡ä»¶ |
| `FunctionDef` | å‡½æ•°å®šä¹‰ | `def foo():` |
| `AnnAssign` | ç±»å‹æ³¨è§£èµ‹å€¼ | `x: int = 5` |
| `Assign` | èµ‹å€¼ | `x = 5` |
| `BinOp` | äºŒå…ƒè¿ç®— | `x + y` |
| `Compare` | æ¯”è¾ƒ | `x > 5` |
| `If` | æ¡ä»¶è¯­å¥ | `if x > 0:` |
| `While` | å¾ªç¯ | `while x < 10:` |
| `Return` | è¿”å› | `return x` |
| `Assert` | æ–­è¨€ | `assert x > 0` |

### ç±»å‹ä¿¡æ¯

ESBMCæ”¯æŒçš„ç±»å‹ï¼š
- **åŸºç¡€ç±»å‹**: `int`, `float`, `bool`, `str`
- **å¤åˆç±»å‹**: `list`, `tuple`, `dict` (æœ‰é™æ”¯æŒ)
- **è‡ªå®šä¹‰ç±»å‹**: `class`
- **ç‰¹æ®Šç±»å‹**: `None`, `Any`, `Union`

---

## ğŸ“ æ–‡ä»¶æ¸…å•

ç”ŸæˆJSONåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
code/
â”œâ”€â”€ esbmc_verification_tests.py      # åŸå§‹Pythonä»£ç 
â”œâ”€â”€ esbmc_verification_tests_ast.json  # JSON 1: AST
â”œâ”€â”€ esbmc_verification_tests_typed_ast.json  # JSON 2: ç±»å‹æ ‡æ³¨
â”œâ”€â”€ generate_ast_json.py              # JSONç”Ÿæˆå·¥å…·
â””â”€â”€ ESBMC_JSONå¤„ç†è¯´æ˜.md             # æœ¬æ–‡æ¡£
```

---

## ğŸš€ å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1: æŸ¥çœ‹ç®€å•å‡½æ•°çš„AST

```bash
# 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
cat > test_add.py << 'EOF'
def add(x: int, y: int) -> int:
    return x + y

result: int = add(5, 10)
assert result == 15
EOF

# 2. ç”ŸæˆJSON
python generate_ast_json.py test_add.py

# 3. æŸ¥çœ‹JSONï¼ˆä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æˆ–jqï¼‰
cat test_add_ast.json | python -m json.tool

# 4. è¿è¡ŒESBMCéªŒè¯
esbmc test_add.py
```

### ç»ƒä¹ 2: å¯¹æ¯”æœ‰ç±»å‹æ³¨è§£å’Œæ— ç±»å‹æ³¨è§£çš„åŒºåˆ«

**æœ‰ç±»å‹æ³¨è§£**:
```python
def calc(x: int) -> int:
    return x * 2
```

**æ— ç±»å‹æ³¨è§£**:
```python
def calc(x):
    return x * 2
```

ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶çš„AST JSONå¹¶å¯¹æ¯”ï¼š
```bash
python generate_ast_json.py calc_typed.py
python generate_ast_json.py calc_untyped.py
diff calc_typed_ast.json calc_untyped_ast.json
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. âœ… **ä¸¤ä¸ªJSONæ–‡ä»¶**:
   - AST JSON (è¯­æ³•ç»“æ„)
   - Typed AST JSON (ç±»å‹ä¿¡æ¯)

2. âœ… **è‡ªåŠ¨å¤„ç†**:
   - ESBMCå†…éƒ¨è‡ªåŠ¨å®Œæˆè¿™äº›æ­¥éª¤
   - ç”¨æˆ·é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ç”Ÿæˆ

3. âœ… **å·¥å…·æ”¯æŒ**:
   - `generate_ast_json.py` å¸®åŠ©ç†è§£è¿‡ç¨‹
   - ç”¨äºå­¦ä¹ å’Œè°ƒè¯•

4. âœ… **ç±»å‹æ³¨è§£é‡è¦**:
   - æ˜¾å¼ç±»å‹æ³¨è§£æé«˜éªŒè¯å‡†ç¡®æ€§
   - ESBMCå¯ä»¥è‡ªåŠ¨æ¨æ–­éƒ¨åˆ†ç±»å‹

### æ¨èå·¥ä½œæµ

```bash
# 1. ç¼–å†™å¸¦ç±»å‹æ³¨è§£çš„Pythonä»£ç 
# 2. (å¯é€‰) ç”ŸæˆAST JSONæŸ¥çœ‹ç»“æ„
python generate_ast_json.py your_code.py

# 3. ç›´æ¥ä½¿ç”¨ESBMCéªŒè¯
esbmc your_code.py --function test_function

# 4. (å¯é€‰) æŸ¥çœ‹ä¸­é—´è¡¨ç¤º
esbmc your_code.py --show-goto-functions
```

---

**å‚è€ƒèµ„æº**:
- [ESBMC Python Frontend README](https://github.com/esbmc/esbmc/blob/master/src/python-frontend/README.md)
- [Python ASTæ–‡æ¡£](https://docs.python.org/3/library/ast.html)
- [ast2jsonåŒ…](https://pypi.org/project/ast2json/)

**ç›¸å…³æ–‡æ¡£**:
- `ESBMCå½¢å¼åŒ–éªŒè¯æŠ¥å‘Š.md` - ç¬¬2èŠ‚è¯¦ç»†ä»‹ç»äº†éªŒè¯åŸç†
- `ESBMCå¿«é€Ÿå¼€å§‹æŒ‡å—.md` - åŸºç¡€ä½¿ç”¨æŒ‡å—



















